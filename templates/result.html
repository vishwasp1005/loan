<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoanShield - Prediction Result</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=14">
    
    <!-- jsPDF Library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #f8f4ef, #f6ece3, #fbf7f2);
            background-size: 400% 400%;
            animation: bgShift 16s ease infinite;
        }

        @keyframes bgShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .result-container {
            max-width: 700px;
            margin: 50px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            text-align: center;
            animation: slideUp 0.8s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounceIn 0.6s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .result-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #3A2F2F;
        }

        .result-message {
            font-size: 18px;
            color: #5A4A3B;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .result-details {
            background: #FAF7F2;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
        }

        .result-details h3 {
            color: #6A4C36;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e8e0d5;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #6A4C36;
        }

        .detail-value {
            color: #5A4A3B;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .btn-download {
            padding: 13px 26px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5);
        }

        .safe-result {
            background: linear-gradient(135deg, #D4F8D4, #B8E6B8);
        }

        .danger-result {
            background: linear-gradient(135deg, #FFD4D4, #FFBBBB);
        }

        .recommendations {
            background: #FFF9F0;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #C7A27C;
        }

        .recommendations h4 {
            color: #6A4C36;
            margin-bottom: 10px;
        }

        .recommendations ul {
            text-align: left;
            color: #5A4A3B;
            line-height: 1.8;
        }

        @media(max-width: 600px) {
            .result-container {
                padding: 30px 20px;
                margin: 30px 15px;
            }

            .result-icon {
                font-size: 60px;
            }

            .result-title {
                font-size: 28px;
            }

            .result-message {
                font-size: 16px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-download,
            .btn-primary,
            .btn-secondary {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body class="fade-in">
    {% include 'navbar.html' %}

    <div class="page-container">
        <div class="result-container {% if prediction == 0 %}safe-result{% else %}danger-result{% endif %}">
            
            <div class="result-icon">
                {% if prediction == 0 %}
                    ‚úÖ
                {% else %}
                    ‚ö†Ô∏è
                {% endif %}
            </div>

            <h1 class="result-title">
                {% if prediction == 0 %}
                    Loan Approved - Low Risk
                {% else %}
                    High Default Risk Detected
                {% endif %}
            </h1>

            <p class="result-message">
                {% if prediction == 0 %}
                    Great news! Based on our AI analysis, this loan application shows <strong>low risk</strong> characteristics. 
                    The applicant demonstrates strong financial indicators.
                {% else %}
                    Our AI model has detected <strong>high default risk</strong> for this application. 
                    We recommend careful review before proceeding.
                {% endif %}
            </p>

            <!-- Loan Details Section -->
            <div class="result-details">
                <h3>üìä Application Details</h3>
                <div class="detail-row">
                    <span class="detail-label">Age:</span>
                    <span class="detail-value" id="detail-age">{{ session.get('last_prediction', {}).get('age', 'N/A') }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Income:</span>
                    <span class="detail-value" id="detail-income">${{ "{:,.2f}".format(session.get('last_prediction', {}).get('income', 0)) }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Loan Amount:</span>
                    <span class="detail-value" id="detail-loan">${{ "{:,.2f}".format(session.get('last_prediction', {}).get('loan_amount', 0)) }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Credit Score:</span>
                    <span class="detail-value" id="detail-credit">{{ session.get('last_prediction', {}).get('credit_score', 'N/A') }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">DTI Ratio:</span>
                    <span class="detail-value" id="detail-dti">{{ session.get('last_prediction', {}).get('dti_ratio', 'N/A') }}%</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Education:</span>
                    <span class="detail-value" id="detail-education">{{ session.get('last_prediction', {}).get('education', 'N/A') }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Employment:</span>
                    <span class="detail-value" id="detail-employment">{{ session.get('last_prediction', {}).get('employment', 'N/A') }}</span>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="recommendations">
                <h4>üí° Recommendations</h4>
                <ul>
                    {% if prediction == 0 %}
                        <li>Applicant shows strong financial stability</li>
                        <li>Credit score is in healthy range</li>
                        <li>Income-to-loan ratio is favorable</li>
                        <li>Consider standard approval process</li>
                    {% else %}
                        <li>Request additional documentation</li>
                        <li>Consider requiring a co-signer</li>
                        <li>Review recent credit history in detail</li>
                        <li>Possibly offer with higher interest rate or lower amount</li>
                    {% endif %}
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-download" onclick="downloadPDF()">
                    üìÑ Download PDF Report
                </button>
                <a href="/predict" class="btn-primary">
                    ‚Üê New Prediction
                </a>
                <a href="/dashboard" class="btn-secondary">
                    View Dashboard
                </a>
            </div>
        </div>
    </div>

    <script>
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get current date
            const date = new Date().toLocaleDateString();
            
            // Get prediction result
            const isPrediction = {{ prediction }};
            const result = isPrediction === 0 ? 'LOW RISK - APPROVED' : 'HIGH RISK - REVIEW REQUIRED';
            const resultColor = isPrediction === 0 ? [76, 175, 80] : [244, 67, 54];
            
            // Title
            doc.setFontSize(24);
            doc.setTextColor(106, 76, 54);
            doc.text('LoanShield', 105, 20, { align: 'center' });
            
            doc.setFontSize(16);
            doc.text('Loan Risk Assessment Report', 105, 30, { align: 'center' });
            
            // Date
            doc.setFontSize(10);
            doc.setTextColor(90, 74, 59);
            doc.text(`Generated: ${date}`, 105, 38, { align: 'center' });
            
            // Line separator
            doc.setDrawColor(199, 162, 124);
            doc.setLineWidth(0.5);
            doc.line(20, 42, 190, 42);
            
            // Result Box
            doc.setFillColor(...resultColor);
            doc.rect(20, 48, 170, 18, 'F');
            doc.setFontSize(16);
            doc.setTextColor(255, 255, 255);
            doc.text(result, 105, 59, { align: 'center' });
            
            // Application Details
            doc.setFontSize(14);
            doc.setTextColor(106, 76, 54);
            doc.text('Application Details', 20, 78);
            
            doc.setFontSize(11);
            doc.setTextColor(90, 74, 59);
            
            const details = [
                ['Age:', document.getElementById('detail-age').textContent],
                ['Income:', document.getElementById('detail-income').textContent],
                ['Loan Amount:', document.getElementById('detail-loan').textContent],
                ['Credit Score:', document.getElementById('detail-credit').textContent],
                ['DTI Ratio:', document.getElementById('detail-dti').textContent],
                ['Education:', document.getElementById('detail-education').textContent],
                ['Employment:', document.getElementById('detail-employment').textContent]
            ];
            
            let yPos = 88;
            details.forEach(([label, value]) => {
                doc.setFont(undefined, 'bold');
                doc.text(label, 25, yPos);
                doc.setFont(undefined, 'normal');
                doc.text(value, 80, yPos);
                yPos += 8;
            });
            
            // Recommendations
            yPos += 10;
            doc.setFontSize(14);
            doc.setTextColor(106, 76, 54);
            doc.text('Recommendations', 20, yPos);
            
            doc.setFontSize(10);
            doc.setTextColor(90, 74, 59);
            
            const recommendations = isPrediction === 0 ? [
                '‚Ä¢ Applicant shows strong financial stability',
                '‚Ä¢ Credit score is in healthy range',
                '‚Ä¢ Income-to-loan ratio is favorable',
                '‚Ä¢ Consider standard approval process'
            ] : [
                '‚Ä¢ Request additional documentation',
                '‚Ä¢ Consider requiring a co-signer',
                '‚Ä¢ Review recent credit history in detail',
                '‚Ä¢ Possibly offer with higher interest rate'
            ];
            
            yPos += 8;
            recommendations.forEach(rec => {
                doc.text(rec, 25, yPos);
                yPos += 6;
            });
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text('This report is generated by LoanShield AI-powered risk assessment system.', 105, 280, { align: 'center' });
            doc.text('For questions, contact support@loanshield.com', 105, 285, { align: 'center' });
            
            // Save PDF
            const filename = `LoanShield_Report_${date.replace(/\//g, '-')}.pdf`;
            doc.save(filename);
            
            // Show success message
            alert('‚úÖ PDF Report downloaded successfully!');
        }
    </script>

    {% include 'footer.html' %}
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
</body>
</html>
